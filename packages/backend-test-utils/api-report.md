## API Report File for "@backstage/backend-test-utils"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="jest" />

import { AuthorizePermissionRequest } from '@backstage/plugin-permission-common';
import { Backend } from '@backstage/backend-app-api';
import { BackendFeature } from '@backstage/backend-plugin-api';
import { BackstageIdentityResponse } from '@backstage/plugin-auth-node';
import { CacheService } from '@backstage/backend-plugin-api';
import { CacheServiceOptions } from '@backstage/backend-plugin-api';
import { CacheServiceSetOptions } from '@backstage/backend-plugin-api';
import { DatabaseService } from '@backstage/backend-plugin-api';
import { DefinitivePolicyDecision } from '@backstage/plugin-permission-common';
import { EvaluatorRequestOptions } from '@backstage/plugin-permission-common';
import { ExtendedHttpServer } from '@backstage/backend-app-api';
import { ExtensionPoint } from '@backstage/backend-plugin-api';
import { Handler } from 'express';
import { HttpRouterFactoryOptions } from '@backstage/backend-app-api';
import { HttpRouterService } from '@backstage/backend-plugin-api';
import { IdentityApiGetIdentityRequest } from '@backstage/plugin-auth-node';
import { IdentityService } from '@backstage/backend-plugin-api';
import { JsonObject } from '@backstage/types';
import { JsonValue } from '@backstage/types';
import { Knex } from 'knex';
import { LifecycleService } from '@backstage/backend-plugin-api';
import { LifecycleServiceShutdownHook } from '@backstage/backend-plugin-api';
import { LifecycleServiceShutdownOptions } from '@backstage/backend-plugin-api';
import { LifecycleServiceStartupHook } from '@backstage/backend-plugin-api';
import { LifecycleServiceStartupOptions } from '@backstage/backend-plugin-api';
import { LoggerService } from '@backstage/backend-plugin-api';
import { PermissionsService } from '@backstage/backend-plugin-api';
import { PolicyDecision } from '@backstage/plugin-permission-common';
import { QueryPermissionRequest } from '@backstage/plugin-permission-common';
import { ReadTreeOptions } from '@backstage/backend-plugin-api';
import { ReadTreeResponse } from '@backstage/backend-plugin-api';
import { ReadUrlOptions } from '@backstage/backend-plugin-api';
import { ReadUrlResponse } from '@backstage/backend-plugin-api';
import { RootConfigService } from '@backstage/backend-plugin-api';
import { RootLifecycleService } from '@backstage/backend-plugin-api';
import { RootLoggerService } from '@backstage/backend-plugin-api';
import { SchedulerService } from '@backstage/backend-plugin-api';
import { SearchOptions } from '@backstage/backend-plugin-api';
import { SearchResponse } from '@backstage/backend-plugin-api';
import { ServiceFactory } from '@backstage/backend-plugin-api';
import { TaskDescriptor } from '@backstage/backend-tasks';
import { TaskInvocationDefinition } from '@backstage/backend-tasks';
import { TaskRunner } from '@backstage/backend-tasks';
import { TaskScheduleDefinition } from '@backstage/backend-tasks';
import { TokenManagerService } from '@backstage/backend-plugin-api';
import { UrlReaderService } from '@backstage/backend-plugin-api';

// @public (undocumented)
export function isDockerDisabledForTests(): boolean;

// @public (undocumented)
export namespace mockServices {
  // (undocumented)
  export namespace cache {
    const // (undocumented)
      factory: () => ServiceFactory<CacheService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<CacheService> | undefined) => {
        factory: ServiceFactory<CacheService, 'root' | 'plugin'>;
      } & {
        get: jest.MockInstance<
          Promise<JsonValue | undefined>,
          [key: string],
          unknown
        >;
        set: jest.MockInstance<
          Promise<void>,
          [
            key: string,
            value: JsonValue,
            options?: CacheServiceSetOptions | undefined,
          ],
          unknown
        >;
        delete: jest.MockInstance<Promise<void>, [key: string], unknown>;
        withOptions: jest.MockInstance<
          CacheService,
          [options: CacheServiceOptions],
          unknown
        >;
      } & CacheService;
  }
  // (undocumented)
  export namespace database {
    const // (undocumented)
      factory: () => ServiceFactory<DatabaseService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<DatabaseService> | undefined) => {
        factory: ServiceFactory<DatabaseService, 'root' | 'plugin'>;
      } & {
        getClient: jest.MockInstance<Promise<Knex<any, any[]>>, [], unknown>;
        migrations?:
          | {
              skip?: boolean | undefined;
            }
          | undefined;
      } & DatabaseService;
  }
  // (undocumented)
  export namespace httpRouter {
    const // (undocumented)
      factory: (
        options?: HttpRouterFactoryOptions | undefined,
      ) => ServiceFactory<HttpRouterService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<HttpRouterService> | undefined) => {
        factory: ServiceFactory<HttpRouterService, 'root' | 'plugin'>;
      } & {
        use: jest.MockInstance<void, [handler: Handler], unknown>;
      } & HttpRouterService;
  }
  // (undocumented)
  export function identity(): IdentityService;
  // (undocumented)
  export namespace identity {
    const // (undocumented)
      factory: () => ServiceFactory<IdentityService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<IdentityService> | undefined) => {
        factory: ServiceFactory<IdentityService, 'root' | 'plugin'>;
      } & {
        getIdentity: jest.MockInstance<
          Promise<BackstageIdentityResponse | undefined>,
          [options: IdentityApiGetIdentityRequest],
          unknown
        >;
      } & IdentityService;
  }
  // (undocumented)
  export namespace lifecycle {
    const // (undocumented)
      factory: () => ServiceFactory<LifecycleService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<LifecycleService> | undefined) => {
        factory: ServiceFactory<LifecycleService, 'root' | 'plugin'>;
      } & {
        addStartupHook: jest.MockInstance<
          void,
          [
            hook: LifecycleServiceStartupHook,
            options?: LifecycleServiceStartupOptions | undefined,
          ],
          unknown
        >;
        addShutdownHook: jest.MockInstance<
          void,
          [
            hook: LifecycleServiceShutdownHook,
            options?: LifecycleServiceShutdownOptions | undefined,
          ],
          unknown
        >;
      } & LifecycleService;
  }
  // (undocumented)
  export namespace logger {
    const // (undocumented)
      factory: () => ServiceFactory<LoggerService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<LoggerService> | undefined) => {
        factory: ServiceFactory<LoggerService, 'root' | 'plugin'>;
      } & {
        error: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        warn: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        info: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        debug: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        child: jest.MockInstance<LoggerService, [meta: JsonObject], unknown>;
      } & LoggerService;
  }
  // (undocumented)
  export namespace permissions {
    const // (undocumented)
      factory: () => ServiceFactory<PermissionsService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<PermissionsService> | undefined) => {
        factory: ServiceFactory<PermissionsService, 'root' | 'plugin'>;
      } & {
        authorize: jest.MockInstance<
          Promise<DefinitivePolicyDecision[]>,
          [
            requests: AuthorizePermissionRequest[],
            options?: EvaluatorRequestOptions | undefined,
          ],
          unknown
        >;
        authorizeConditional: jest.MockInstance<
          Promise<PolicyDecision[]>,
          [
            requests: QueryPermissionRequest[],
            options?: EvaluatorRequestOptions | undefined,
          ],
          unknown
        >;
      } & PermissionsService;
  }
  // (undocumented)
  export function rootConfig(options?: rootConfig.Options): RootConfigService;
  // (undocumented)
  export namespace rootConfig {
    // (undocumented)
    export type Options = {
      data?: JsonObject;
    };
    const // (undocumented)
      factory: (
        options?: Options | undefined,
      ) => ServiceFactory<RootConfigService, 'root'>;
  }
  // (undocumented)
  export namespace rootLifecycle {
    const // (undocumented)
      factory: () => ServiceFactory<RootLifecycleService, 'root'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<RootLifecycleService> | undefined) => {
        factory: ServiceFactory<RootLifecycleService, 'root' | 'plugin'>;
      } & {
        addStartupHook: jest.MockInstance<
          void,
          [
            hook: LifecycleServiceStartupHook,
            options?: LifecycleServiceStartupOptions | undefined,
          ],
          unknown
        >;
        addShutdownHook: jest.MockInstance<
          void,
          [
            hook: LifecycleServiceShutdownHook,
            options?: LifecycleServiceShutdownOptions | undefined,
          ],
          unknown
        >;
      } & RootLifecycleService;
  }
  // (undocumented)
  export function rootLogger(options?: rootLogger.Options): LoggerService;
  // (undocumented)
  export namespace rootLogger {
    // (undocumented)
    export type Options = {
      level?: 'none' | 'error' | 'warn' | 'info' | 'debug';
    };
    const // (undocumented)
      factory: (
        options?: Options | undefined,
      ) => ServiceFactory<LoggerService, 'root'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<RootLoggerService> | undefined) => {
        factory: ServiceFactory<RootLoggerService, 'root' | 'plugin'>;
      } & {
        error: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        warn: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        info: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        debug: jest.MockInstance<
          void,
          [message: string, meta?: Error | JsonObject | undefined],
          unknown
        >;
        child: jest.MockInstance<LoggerService, [meta: JsonObject], unknown>;
      } & RootLoggerService;
  }
  // (undocumented)
  export namespace scheduler {
    const // (undocumented)
      factory: () => ServiceFactory<SchedulerService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<SchedulerService> | undefined) => {
        factory: ServiceFactory<SchedulerService, 'root' | 'plugin'>;
      } & {
        triggerTask: jest.MockInstance<Promise<void>, [id: string], unknown>;
        scheduleTask: jest.MockInstance<
          Promise<void>,
          [task: TaskScheduleDefinition & TaskInvocationDefinition],
          unknown
        >;
        createScheduledTaskRunner: jest.MockInstance<
          TaskRunner,
          [schedule: TaskScheduleDefinition],
          unknown
        >;
        getScheduledTasks: jest.MockInstance<
          Promise<TaskDescriptor[]>,
          [],
          unknown
        >;
      } & SchedulerService;
  }
  // (undocumented)
  export function tokenManager(): TokenManagerService;
  // (undocumented)
  export namespace tokenManager {
    const // (undocumented)
      factory: () => ServiceFactory<TokenManagerService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<TokenManagerService> | undefined) => {
        factory: ServiceFactory<TokenManagerService, 'root' | 'plugin'>;
      } & {
        getToken: jest.MockInstance<
          Promise<{
            token: string;
          }>,
          [],
          unknown
        >;
        authenticate: jest.MockInstance<
          Promise<void>,
          [token: string],
          unknown
        >;
      } & TokenManagerService;
  }
  // (undocumented)
  export namespace urlReader {
    const // (undocumented)
      factory: () => ServiceFactory<UrlReaderService, 'plugin'>;
    const // (undocumented)
      mock: (partialImpl?: Partial<UrlReaderService> | undefined) => {
        factory: ServiceFactory<UrlReaderService, 'root' | 'plugin'>;
      } & {
        readUrl: jest.MockInstance<
          Promise<ReadUrlResponse>,
          [url: string, options?: ReadUrlOptions | undefined],
          unknown
        >;
        readTree: jest.MockInstance<
          Promise<ReadTreeResponse>,
          [url: string, options?: ReadTreeOptions | undefined],
          unknown
        >;
        search: jest.MockInstance<
          Promise<SearchResponse>,
          [url: string, options?: SearchOptions | undefined],
          unknown
        >;
      } & UrlReaderService;
  }
}

// @public
export function setupRequestMockHandlers(worker: {
  listen: (t: any) => void;
  close: () => void;
  resetHandlers: () => void;
}): void;

// @public (undocumented)
export function startTestBackend<TExtensionPoints extends any[]>(
  options: TestBackendOptions<TExtensionPoints>,
): Promise<TestBackend>;

// @public (undocumented)
export interface TestBackend extends Backend {
  readonly server: ExtendedHttpServer;
}

// @public (undocumented)
export interface TestBackendOptions<TExtensionPoints extends any[]> {
  // (undocumented)
  extensionPoints?: readonly [
    ...{
      [index in keyof TExtensionPoints]: [
        ExtensionPoint<TExtensionPoints[index]>,
        Partial<TExtensionPoints[index]>,
      ];
    },
  ];
  // (undocumented)
  features?: Array<BackendFeature | (() => BackendFeature)>;
}

// @public
export type TestDatabaseId =
  | 'POSTGRES_14'
  | 'POSTGRES_13'
  | 'POSTGRES_12'
  | 'POSTGRES_11'
  | 'POSTGRES_9'
  | 'MYSQL_8'
  | 'SQLITE_3';

// @public
export class TestDatabases {
  static create(options?: {
    ids?: TestDatabaseId[];
    disableDocker?: boolean;
  }): TestDatabases;
  // (undocumented)
  eachSupportedId(): [TestDatabaseId][];
  init(id: TestDatabaseId): Promise<Knex>;
  // (undocumented)
  supports(id: TestDatabaseId): boolean;
}
```
